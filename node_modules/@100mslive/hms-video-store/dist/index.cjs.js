var Lt=Object.create;var X=Object.defineProperty,xt=Object.defineProperties,Ot=Object.getOwnPropertyDescriptor,Nt=Object.getOwnPropertyDescriptors,wt=Object.getOwnPropertyNames,Xe=Object.getOwnPropertySymbols,Ut=Object.getPrototypeOf,ze=Object.prototype.hasOwnProperty,Kt=Object.prototype.propertyIsEnumerable;var Ze=(s,e,t)=>e in s?X(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,w=(s,e)=>{for(var t in e||(e={}))ze.call(e,t)&&Ze(s,t,e[t]);if(Xe)for(var t of Xe(e))Kt.call(e,t)&&Ze(s,t,e[t]);return s},W=(s,e)=>xt(s,Nt(e)),et=s=>X(s,"__esModule",{value:!0});var _t=(s,e)=>{et(s);for(var t in e)X(s,t,{get:e[t],enumerable:!0})},Vt=(s,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of wt(e))!ze.call(s,i)&&i!=="default"&&X(s,i,{get:()=>e[i],enumerable:!(t=Ot(e,i))||t.enumerable});return s},I=s=>Vt(et(X(s!=null?Lt(Ut(s)):{},"default",s&&s.__esModule&&"default"in s?{get:()=>s.default,enumerable:!0}:{value:s,enumerable:!0})),s);var l=(s,e,t)=>new Promise((i,o)=>{var r=u=>{try{a(t.next(u))}catch(P){o(P)}},n=u=>{try{a(t.throw(u))}catch(P){o(P)}},a=u=>u.done?i(u.value):Promise.resolve(u.value).then(r,n);a((t=t.apply(s,e)).next())});_t(exports,{HMSAudioPluginType:()=>c.HMSAudioPluginType,HMSLogLevel:()=>c.HMSLogLevel,HMSMessageType:()=>fe,HMSNotificationSeverity:()=>R,HMSNotificationTypes:()=>g,HMSPlaylistType:()=>M,HMSReactiveStore:()=>O,HMSRoomState:()=>T,HMSStats:()=>ae,HMSVideoPluginCanvasContextType:()=>c.HMSVideoPluginCanvasContextType,HMSVideoPluginType:()=>c.HMSVideoPluginType,createDefaultStatsStore:()=>Z,createDefaultStoreState:()=>z,parsedUserAgent:()=>c.parsedUserAgent,selectAppData:()=>hs,selectAppDataByPath:()=>Ts,selectAudioPlaylist:()=>Ue,selectAudioPlaylistTrackByPeerID:()=>Es,selectAudioTrackByPeerID:()=>ht,selectAudioTrackVolume:()=>$e,selectAudioVolumeByPeerID:()=>Ns,selectAuxiliaryAudioByPeerID:()=>vs,selectAuxiliaryTracksByPeerID:()=>fs,selectAvailableRoleNames:()=>cs,selectBroadcastMessages:()=>ft,selectBroadcastMessagesUnreadCount:()=>Vs,selectCameraStreamByPeerID:()=>ys,selectConnectionQualities:()=>Ft,selectConnectionQualityByPeerID:()=>Is,selectDegradedTracks:()=>rs,selectDevices:()=>$t,selectDidIJoinWithin:()=>ri,selectDominantSpeaker:()=>zt,selectFullAppData:()=>de,selectHLSState:()=>us,selectHMSMessages:()=>ie,selectHMSMessagesCount:()=>Le,selectHMSStats:()=>bt,selectIsAllowedToPublish:()=>Xs,selectIsAllowedToSubscribe:()=>ls,selectIsAudioLocallyMuted:()=>je,selectIsConnectedToRoom:()=>nt,selectIsInPreview:()=>as,selectIsLocalAudioEnabled:()=>Zt,selectIsLocalAudioPluginPresent:()=>si,selectIsLocalScreenShared:()=>pe,selectIsLocalVideoDisplayEnabled:()=>Ae,selectIsLocalVideoEnabled:()=>ue,selectIsLocalVideoPluginPresent:()=>ti,selectIsLocallyMutedByPeerID:()=>xs,selectIsPeerAudioEnabled:()=>As,selectIsPeerVideoEnabled:()=>Ls,selectIsScreenShareLocallyMutedByPeerID:()=>Os,selectIsSomeoneScreenSharing:()=>es,selectLocalAudioTrackID:()=>A,selectLocalMediaSettings:()=>Ee,selectLocalPeer:()=>b,selectLocalPeerID:()=>q,selectLocalPeerName:()=>Gt,selectLocalPeerRole:()=>oe,selectLocalPeerRoleName:()=>Jt,selectLocalTrackIDs:()=>Ce,selectLocalVideoTrackID:()=>L,selectMessageIDsInOrder:()=>be,selectMessagesByPeerID:()=>Bs,selectMessagesByRole:()=>qs,selectMessagesMap:()=>De,selectMessagesUnreadCountByPeerID:()=>$s,selectMessagesUnreadCountByRole:()=>js,selectPeerAudioByID:()=>Rs,selectPeerByCondition:()=>ii,selectPeerByID:()=>x,selectPeerCount:()=>Wt,selectPeerMetadata:()=>Ws,selectPeerName:()=>Qs,selectPeerNameByID:()=>Hs,selectPeerScreenSharing:()=>at,selectPeerSharingAudio:()=>ts,selectPeerSharingAudioPlaylist:()=>os,selectPeerSharingVideoPlaylist:()=>is,selectPeers:()=>F,selectPeersByCondition:()=>oi,selectPeersByRole:()=>Fs,selectPeersMap:()=>D,selectPeersScreenSharing:()=>ss,selectPeersWithAudioStatus:()=>Gs,selectPermissions:()=>Oe,selectRTMPState:()=>ds,selectRecordingState:()=>Ss,selectRemotePeers:()=>Xt,selectRoleByRoleName:()=>zs,selectRoleChangeRequest:()=>Ys,selectRolesMap:()=>_,selectRoom:()=>v,selectRoomID:()=>jt,selectRoomStartTime:()=>Ms,selectRoomStarted:()=>xe,selectRoomState:()=>E,selectScreenShareAudioByPeerID:()=>qe,selectScreenShareByPeerID:()=>Cs,selectScreenSharesByPeerId:()=>Be,selectScreenshareAudioVolumeByPeerID:()=>ws,selectSessionId:()=>ps,selectSimulcastLayerByTrack:()=>Us,selectSpeakers:()=>rt,selectTrackAudioByID:()=>ks,selectTrackByID:()=>G,selectTracksMap:()=>y,selectUnreadHMSMessagesCount:()=>ns,selectVideoPlaylist:()=>Ke,selectVideoPlaylistAudioTrackByPeerID:()=>bs,selectVideoPlaylistVideoTrackByPeerID:()=>Ds,selectVideoTrackByPeerID:()=>gt});var Et=I(require("immer")),Ct=I(require("zustand/vanilla")),At=I(require("zustand/shallow")),ye=I(require("@100mslive/hms-video"));var T;(function(a){a.Disconnected="Disconnected",a.Preview="Preview",a.Connecting="Connecting",a.Connected="Connected",a.Reconnecting="Reconnecting",a.Disconnecting="Disconnecting",a.Failed="Failed"})(T||(T={}));var z=()=>({room:{id:"",isConnected:!1,name:"",peers:[],shareableLink:"",localPeer:"",hasWaitingRoom:!1,roomState:T.Disconnected,recording:{browser:{running:!1},server:{running:!1},hls:{running:!1}},rtmp:{running:!1},hls:{running:!1,variants:[]},sessionId:""},peers:{},tracks:{},playlist:{audio:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1},video:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1}},messages:{byID:{},allIDs:[]},speakers:{},connectionQualities:{},settings:{audioInputDeviceId:"",audioOutputDeviceId:"",videoInputDeviceId:""},devices:{audioInput:[],audioOutput:[],videoInput:[]},roles:{},roleChangeRequests:[],errors:[]}),Z=()=>({peerStats:{},trackStats:{},localPeer:{id:""}});var fe;(function(e){e.CHAT="chat"})(fe||(fe={}));var R;(function(t){t.INFO="info",t.ERROR="error"})(R||(R={}));var g;(function(S){S.PEER_JOINED="PEER_JOINED",S.PEER_LEFT="PEER_LEFT",S.PEER_LIST="PEER_LIST",S.NEW_MESSAGE="NEW_MESSAGE",S.ERROR="ERROR",S.RECONNECTING="RECONNECTING",S.RECONNECTED="RECONNECTED",S.TRACK_ADDED="TRACK_ADDED",S.TRACK_REMOVED="TRACK_REMOVED",S.TRACK_MUTED="TRACK_MUTED",S.TRACK_UNMUTED="TRACK_UNMUTED",S.TRACK_DEGRADED="TRACK_DEGRADED",S.TRACK_RESTORED="TRACK_RESTORED",S.TRACK_DESCRIPTION_CHANGED="TRACK_DESCRIPTION_CHANGED",S.ROLE_UPDATED="ROLE_UPDATED",S.CHANGE_TRACK_STATE_REQUEST="CHANGE_TRACK_STATE_REQUEST",S.CHANGE_MULTI_TRACK_STATE_REQUEST="CHANGE_MULTI_TRACK_STATE_REQUEST",S.ROOM_ENDED="ROOM_ENDED",S.REMOVED_FROM_ROOM="REMOVED_FROM_ROOM",S.DEVICE_CHANGE_UPDATE="DEVICE_CHANGE_UPDATE",S.PLAYLIST_TRACK_ENDED="PLAYLIST_TRACK_ENDED",S.NAME_UPDATED="NAME_UPDATED",S.METADATA_UPDATED="METADATA_UPDATED"})(g||(g={}));var M;(function(t){t.audio="audio",t.video="video"})(M||(M={}));var c=I(require("@100mslive/hms-video"));var K=I(require("@100mslive/hms-video"));var tt=(s,e)=>{let t=ve(Object.keys(s),Object.keys(e));for(let i of t){let o=s[i],r=e[i];Pe(o,r)?(U(o.auxiliaryTracks,r.auxiliaryTracks)&&(r.auxiliaryTracks=o.auxiliaryTracks),Object.assign(o,r)):Re(o,r)?delete s[i]:Ie(o,r)&&(s[i]=r)}},st=(s,e)=>{let t=ve(Object.keys(s),Object.keys(e));for(let i of t){let o=s[i],r=e[i];Pe(o,r)?(Bt(o,r),Object.assign(o,r)):Re(o,r)?delete s[i]:Ie(o,r)&&(s[i]=r)}},ke=(s,e)=>{let t=ve(Object.keys(s),Object.keys(e));for(let i of t){let o=s[i],r=e[i];Pe(o,r)?Object.assign(o,r):Re(o,r)?delete s[i]:Ie(o,r)&&(s[i]=r)}},Bt=(s,e)=>{s.plugins&&U(s.plugins,e.plugins)&&(e.plugins=s.plugins),s.layerDefinitions&&U(s.layerDefinitions,e.layerDefinitions)&&(e.layerDefinitions=s.layerDefinitions)},Pe=(s,e)=>s&&e,Re=(s,e)=>s&&!e,Ie=(s,e)=>!s&&e,U=(s,e)=>{if(s===e||s.length===0&&(e==null?void 0:e.length)===0)return!0;if(!s||!e||s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(s[t]!==e[t])return!1;return!0},ve=(s,e)=>{let t=new Set;for(let i of s)t.add(i);for(let i of e)t.add(i);return Array.from(t)};var h=class{static convertPeer(e){var t,i,o;return{id:e.peerId,name:e.name,roleName:(t=e.role)==null?void 0:t.name,isLocal:e.isLocal,videoTrack:(i=e.videoTrack)==null?void 0:i.trackId,audioTrack:(o=e.audioTrack)==null?void 0:o.trackId,auxiliaryTracks:e.auxiliaryTracks.map(r=>r.trackId),customerUserId:e.customerUserId,customerDescription:e.metadata,metadata:e.metadata,joinedAt:e.joinedAt}}static convertTrack(e,t){let i={id:e.trackId,source:e.source,type:e.type,enabled:e.enabled,displayEnabled:e.enabled,peerId:e.peerId||t};return this.enrichTrack(i,e),i}static enrichTrack(e,t){let i=t.getMediaTrackSettings();e.source==="screen"&&e.type==="video"&&(e.displaySurface=i.displaySurface),e.height=i.height,e.width=i.width,t instanceof K.HMSRemoteAudioTrack&&(e.volume=t.getVolume()||0),h.updateDeviceID(e,t),h.enrichVideoTrack(e,t),h.enrichPluginsDetails(e,t)}static updateDeviceID(e,t){var i;t instanceof K.HMSLocalVideoTrack||t instanceof K.HMSLocalAudioTrack?e.deviceID=t.settings.deviceId:e.deviceID=(i=t.getMediaTrackSettings())==null?void 0:i.deviceId}static enrichVideoTrack(e,t){t instanceof K.HMSRemoteVideoTrack&&(e.layer=t.getSimulcastLayer(),e.degraded=t.degraded,U(t.getSimulcastDefinitions(),e.layerDefinitions)||(e.layerDefinitions=t.getSimulcastDefinitions()))}static enrichPluginsDetails(e,t){(t instanceof K.HMSLocalVideoTrack||t instanceof K.HMSLocalAudioTrack)&&(U(t.getPlugins(),e.plugins)||(e.plugins=t.getPlugins()))}static convertRoom(e){var r,n;let{recording:t,rtmp:i,hls:o}=h.convertRecordingStreamingState(e==null?void 0:e.recording,e==null?void 0:e.rtmp,e==null?void 0:e.hls);return{id:e.id,name:e.name,localPeer:(n=(r=e.localPeer)==null?void 0:r.peerId)!=null?n:"",hasWaitingRoom:e.hasWaitingRoom,shareableLink:e.shareableLink,recording:t,rtmp:i,hls:o,sessionId:e.sessionId,startedAt:e.startedAt,joinedAt:e.joinedAt,peerCount:e.peerCount}}static convertMessage(e){var t,i,o,r,n,a,u;return{sender:(t=e.sender)==null?void 0:t.peerId,senderName:(i=e.sender)==null?void 0:i.name,senderRole:(r=(o=e.sender)==null?void 0:o.role)==null?void 0:r.name,senderUserId:(n=e.sender)==null?void 0:n.customerUserId,recipientPeer:(a=e.recipientPeer)==null?void 0:a.peerId,recipientRoles:(u=e.recipientRoles)==null?void 0:u.map(P=>P.name),time:e.time,type:e.type,message:e.message}}static convertRoles(e){let t={};return e&&e.forEach(i=>{t[i.name]=i}),t}static convertRoleChangeRequest(e){var t;return{requestedBy:(t=e.requestedBy)==null?void 0:t.peerId,roleName:e.role.name,token:e.token}}static convertException(e){return{code:e.code,action:e.action,name:e.name,message:e.message,description:e.description,isTerminal:e.isTerminal,nativeError:e.nativeError,timestamp:new Date}}static convertDeviceChangeUpdate(e){let t={devices:e.devices,selection:e.selection,type:e.type};return e.error&&(t.error=this.convertException(e.error)),t}static convertPlaylist(e){let t=this.getConvertedPlaylistType(e,M.audio),i=this.getConvertedPlaylistType(e,M.video);return{audio:t,video:i}}static convertPlaylistItem(e,t){let i=t.type,o=e.getCurrentSelection(i),r=e.isPlaying(i),n=t.url===(o==null?void 0:o.url);return W(w({},t),{type:t.type,selected:n,playing:n&&r})}static getConvertedPlaylistType(e,t){let i={},o=e.getCurrentSelection(t),r=e.getCurrentProgress(t),n=e.getVolume(t),a=e.getList(t),u=e.getCurrentIndex(t);return e.getList(t).forEach(P=>{i[P.id]=h.convertPlaylistItem(e,P)}),{list:i,selection:{id:o==null?void 0:o.id,hasPrevious:u>0,hasNext:u<a.length-1},progress:r,volume:n,currentTime:e.getCurrentTime(t),playbackRate:e.getPlaybackRate(t)}}static convertRecordingStreamingState(e,t,i){var o;return{recording:{browser:w({running:!1},e==null?void 0:e.browser),server:w({running:!1},e==null?void 0:e.server),hls:w({running:!1},e==null?void 0:e.hls)},rtmp:w({running:!1},t),hls:{variants:((o=i==null?void 0:i.variants)==null?void 0:o.map(r=>r))||[],running:!!(i==null?void 0:i.running),error:i==null?void 0:i.error}}}};var d=I(require("reselect"));function $(s,e,t=qt){let i,o;if(e)for(let r of e.auxiliaryTracks){let n=s[r];t(n)&&(o=ee(n)?n:o,i=te(n)?n:i)}return{video:i,audio:o}}function ee(s){return s&&s.type==="audio"}function te(s){return s&&s.type==="video"}function qt(s){return s&&s.source==="screen"}function Se(s){return s&&s.source==="audioplaylist"}function se(s){return s&&s.source==="videoplaylist"}function it(s){return Boolean(s==null?void 0:s.degraded)}function Q(s,e){return e&&s.tracks[e]?s.tracks[e].enabled:!1}function ot(s,e){return e&&s.tracks[e]?s.tracks[e].displayEnabled:!1}var v=s=>s.room,jt=(0,d.createSelector)(v,s=>s.id),D=s=>s.peers,De=s=>s.messages.byID,be=s=>s.messages.allIDs,y=s=>s.tracks,Ee=s=>s.settings,de=s=>s.appData,$t=s=>s.devices,rt=s=>s.speakers,Ft=s=>s.connectionQualities,nt=(0,d.createSelector)([v],s=>s&&s.isConnected),Wt=(0,d.createSelector)([nt,v],(s,e)=>s?e.peerCount!==void 0?e.peerCount||1:e.peers.length:Math.max(e.peerCount!==void 0?e.peerCount:e.peers.length-1,0)),F=(0,d.createSelector)([v,D],(s,e)=>s.peers.map(t=>e[t])),Qt=(0,d.createSelector)(y,s=>Object.values(s)),b=(0,d.createSelector)(v,D,(s,e)=>e[s.localPeer]),q=(0,d.createSelector)(v,s=>s.localPeer),Gt=(0,d.createSelector)(b,s=>s==null?void 0:s.name),Jt=(0,d.createSelector)(b,s=>s==null?void 0:s.roleName),A=(0,d.createSelector)(b,s=>s==null?void 0:s.audioTrack),L=(0,d.createSelector)(b,s=>s==null?void 0:s.videoTrack),Yt=(0,d.createSelector)(b,s=>s==null?void 0:s.auxiliaryTracks),Ce=(0,d.createSelector)([A,L,Yt],(s,e,t)=>{let i=[...t];return s&&i.unshift(s),e&&i.unshift(e),i}),Xt=(0,d.createSelector)(F,s=>s.filter(e=>!e.isLocal)),zt=(0,d.createSelector)(D,rt,(s,e)=>{let t=Object.entries(e).sort((i,o)=>{var a,u;let r=((a=i[1])==null?void 0:a.audioLevel)||0;return(((u=o[1])==null?void 0:u.audioLevel)||0)>r?1:-1});if(t.length>0&&t[0][1].audioLevel&&t[0][1].audioLevel>0){let i=t[0][1].peerID;if(i in s)return s[i]}return null}),Zt=s=>{let e=b(s);return Q(s,e==null?void 0:e.audioTrack)},ue=s=>{let e=b(s);return Q(s,e==null?void 0:e.videoTrack)},Ae=s=>{let e=b(s);return ot(s,e==null?void 0:e.videoTrack)},pe=(0,d.createSelector)(b,y,(s,e)=>{let{video:t,audio:i}=$(e,s);return!!(t||i)}),at=(0,d.createSelector)(D,y,(s,e)=>{let t;for(let i in s){let o=s[i],{video:r,audio:n}=$(e,o);if(r)return o;n&&!t&&(t=o)}return t}),es=(0,d.createSelector)(at,s=>!!s),ts=(0,d.createSelector)(D,y,(s,e)=>{for(let t in s){let i=s[t],{audio:o,video:r}=$(e,i);if(!r&&!!o)return i}}),ss=(0,d.createSelector)(D,y,(s,e)=>{let t=[],i=[];for(let o in s){let r=s[o],{video:n,audio:a}=$(e,r);n?t.push(r):a&&i.push(r)}return t.concat(i)}),is=(0,d.createSelector)(D,y,(s,e)=>{for(let t in e){let i=e[t];if(se(i)&&te(i)&&i.peerId)return s[i.peerId]}}),os=(0,d.createSelector)(D,y,(s,e)=>{for(let t in e){let i=e[t];if(Se(i)&&i.peerId)return s[i.peerId]}}),rs=(0,d.createSelector)(Qt,s=>s.filter(it)),Le=(0,d.createSelector)(be,s=>s.length),ns=(0,d.createSelector)(De,s=>Object.values(s).filter(e=>!e.read).length),ie=(0,d.createSelector)(be,De,(s,e)=>{let t=[];return s.forEach(i=>{t.push(e[i])}),t}),E=(0,d.createSelector)([v],s=>s&&s.roomState),as=(0,d.createSelector)(E,s=>s===T.Preview),xe=(0,d.createSelector)(v,s=>s.roomState!==T.Disconnected),_=s=>s.roles,cs=(0,d.createSelector)([_],s=>Object.keys(s)),oe=(0,d.createSelector)([b,_],(s,e)=>(s==null?void 0:s.roleName)?e[s.roleName]:null),ls=(0,d.createSelector)([oe],s=>{var e;return((e=s==null?void 0:s.subscribeParams)==null?void 0:e.subscribeToRoles)?s.subscribeParams.subscribeToRoles.length>0:!1}),Oe=(0,d.createSelector)(oe,s=>s==null?void 0:s.permissions),Ss=(0,d.createSelector)(v,s=>s.recording),ds=(0,d.createSelector)(v,s=>s.rtmp),us=(0,d.createSelector)(v,s=>s.hls),ps=(0,d.createSelector)(v,s=>s.sessionId),Ms=(0,d.createSelector)(v,s=>s.startedAt);var Ne=I(require("reselect"));var ct=(s=M.audio)=>e=>e.playlist[s].list,we=(s=M.audio)=>e=>e.playlist[s].selection,lt=(s=M.audio)=>e=>e.playlist[s].progress,St=(s=M.audio)=>e=>e.playlist[s].currentTime,dt=(s=M.audio)=>e=>e.playlist[s].playbackRate,ut=(s=M.audio)=>e=>e.playlist[s].volume,pt=(s=M.audio)=>(0,Ne.createSelector)(ct(s),e=>Object.values(e)),Mt=(s=M.audio)=>(0,Ne.createSelector)(ct(s),we(s),(e,t)=>{if(!!t.id)return e[t.id]}),Ue={selection:we(M.audio),progress:lt(M.audio),currentTime:St(M.audio),playbackRate:dt(M.audio),volume:ut(M.audio),list:pt(M.audio),selectedItem:Mt(M.audio)},Ke={selection:we(M.video),progress:lt(M.video),currentTime:St(M.video),playbackRate:dt(M.video),volume:ut(M.video),list:pt(M.video),selectedItem:Mt(M.video)};var f=I(require("reselect"));function p(s){return e=>t=>s(t,e)}var re="HMS-Store:",m=class{static v(e,...t){this.log(c.HMSLogLevel.VERBOSE,e,...t)}static d(...e){this.log(c.HMSLogLevel.DEBUG,...e)}static i(...e){this.log(c.HMSLogLevel.INFO,...e)}static w(...e){this.log(c.HMSLogLevel.WARN,...e)}static e(...e){this.log(c.HMSLogLevel.ERROR,...e)}static time(e){this.log(c.HMSLogLevel.TIME,"[HMSPerformanceTiming]",e)}static timeEnd(e){this.log(c.HMSLogLevel.TIMEEND,"[HMSPerformanceTiming]",e,e)}static cleanUp(){performance.clearMarks(),performance.clearMeasures()}static log(e,...t){if(!(this.level.valueOf()>e.valueOf()))switch(e){case c.HMSLogLevel.VERBOSE:{console.log(re,...t);break}case c.HMSLogLevel.DEBUG:{console.debug(re,...t);break}case c.HMSLogLevel.INFO:{console.info(re,...t);break}case c.HMSLogLevel.WARN:{console.warn(re,...t);break}case c.HMSLogLevel.ERROR:{console.error(re,...t);break}case c.HMSLogLevel.TIME:{performance.mark(t[1]);break}case c.HMSLogLevel.TIMEEND:{let i=t[0],o=t[1];try{let r=performance.measure(o,o);this.log(c.HMSLogLevel.DEBUG,i,o,r==null?void 0:r.duration),performance.clearMarks(o),performance.clearMeasures(o)}catch(r){this.log(c.HMSLogLevel.DEBUG,i,o,r)}break}}}};m.level=c.HMSLogLevel.VERBOSE;var _e=(s,e)=>e,ms=(s,e)=>e,mt=(s,e)=>e,gs=(s,e)=>e,C=(0,f.createSelector)([D,_e],(s,e)=>e?s[e]:null),Ve=(0,f.createSelector)([y,ms],(s,e)=>e?s[e]:null),x=p(C),hs=p((0,f.createSelector)([de,gs],(s,e)=>{if(!!s)return e?s[e]:s})),Ts=(...s)=>(0,f.createSelector)([de],e=>{if(!!e){if(s&&s.length>0){let t=e;for(let i of s){if(!i)return t;t=t==null?void 0:t[i]}return t}return e}}),Hs=p((0,f.createSelector)(C,s=>s==null?void 0:s.name)),G=p(Ve),gt=p((s,e)=>{let t=C(s,e);if(t&&t.videoTrack&&t.videoTrack!=="")return s.tracks[t.videoTrack]}),ht=p((s,e)=>{let t=C(s,e);if(t&&t.audioTrack&&t.audioTrack!=="")return s.tracks[t.audioTrack]}),ys=gt,fs=p((s,e)=>{let t=C(s,e);return(t==null?void 0:t.auxiliaryTracks.map(i=>s.tracks[i]))||[]}),Tt=(s,e)=>e?s.speakers[e]:null,ks=p((0,f.createSelector)(Tt,s=>(s==null?void 0:s.audioLevel)||0)),Ps=(s,e)=>{let t=ht(e)(s);return Tt(s,t==null?void 0:t.id)},Rs=p((0,f.createSelector)(Ps,s=>(s==null?void 0:s.audioLevel)||0)),Is=p((s,e)=>{if(e)return s.connectionQualities[e]}),vs=p((s,e)=>{let t=C(s,e);if(t){let i=t==null?void 0:t.auxiliaryTracks.find(o=>ee(s.tracks[o]));return i?s.tracks[i]:void 0}}),Ds=p((0,f.createSelector)(y,C,(s,e)=>{let t=e==null?void 0:e.auxiliaryTracks.find(i=>{let o=s[i];return se(o)&&te(o)});return t?s[t]:void 0})),bs=p((0,f.createSelector)(y,C,(s,e)=>{let t=e==null?void 0:e.auxiliaryTracks.find(i=>{let o=s[i];return se(o)&&ee(o)});return t?s[t]:void 0})),Es=p((0,f.createSelector)(y,C,(s,e)=>{let t=e==null?void 0:e.auxiliaryTracks.find(i=>{let o=s[i];return Se(o)&&ee(o)});return t?s[t]:void 0})),Be=p((0,f.createSelector)(y,C,(s,e)=>$(s,e))),Cs=s=>(0,f.createSelector)(Be(s),e=>e.video),qe=s=>(0,f.createSelector)(Be(s),e=>e.audio),As=p((s,e)=>{let t=C(s,e);return Q(s,t==null?void 0:t.audioTrack)}),Ls=p((s,e)=>{let t=C(s,e);return Q(s,t==null?void 0:t.videoTrack)}),je=p((s,e)=>{if(e&&s.tracks[e])return s.tracks[e].volume===0}),xs=p((s,e)=>{let t=C(s,e);return je(t==null?void 0:t.audioTrack)(s)}),Os=p((s,e)=>{let t=qe(e)(s);return je(t==null?void 0:t.id)(s)}),$e=p((s,e)=>{let t=Ve(s,e);if(t){if(t.type!=="audio"){m.w("Please pass audio track here");return}return t.volume}}),Ns=p((s,e)=>{let t=C(s,e);return $e(t==null?void 0:t.audioTrack)(s)}),ws=p((s,e)=>{let t=qe(e)(s);return $e(t==null?void 0:t.id)(s)}),Us=p((s,e)=>{let t=Ve(s,e);if(t){if(t.type!=="video"){m.w("Please pass video track here");return}return t.layer}}),Ht=(0,f.createSelector)([ie,q,_e],(s,e,t)=>{if(!!t)return s.filter(i=>{var o;return!i.recipientPeer&&!((o=i.recipientRoles)==null?void 0:o.length)||i.sender&&![e,t].includes(i.sender)?!1:[e,t].includes(i.recipientPeer)})}),yt=(0,f.createSelector)([ie,mt],(s,e)=>{if(!!e)return s.filter(t=>{var i,o;return((i=t.recipientRoles)==null?void 0:i.length)?(o=t.recipientRoles)==null?void 0:o.includes(e):!1})}),ft=(0,f.createSelector)(ie,s=>s.filter(e=>{var t;return!e.recipientPeer&&!((t=e.recipientRoles)==null?void 0:t.length)})),Ks=(0,f.createSelector)([yt,mt],s=>s?s.filter(e=>!e.read).length:0),_s=(0,f.createSelector)([Ht,_e],s=>s?s.filter(e=>!e.read).length:0),Vs=(0,f.createSelector)(ft,s=>s.filter(e=>!e.read).length),Bs=p(Ht),qs=p(yt),js=p(Ks),$s=p(_s),Fs=s=>(0,f.createSelector)([F],e=>e.filter(t=>t.roleName===s)),Ws=s=>(0,f.createSelector)(x(s),e=>{try{return(e==null?void 0:e.metadata)&&e.metadata!==""?JSON.parse(e.metadata):{}}catch(t){return console.error("cannot parse peer metadata",t),{}}}),Qs=s=>(0,f.createSelector)(x(s),e=>e==null?void 0:e.name);var Me=I(require("reselect")),Gs=(0,Me.createSelector)([D,y],(s,e)=>Object.values(s).map(i=>{var o;return{peer:i,isAudioEnabled:i.audioTrack?(o=e[i.audioTrack])==null?void 0:o.enabled:!1}})),Js=s=>s.roleChangeRequests[0]||null,Ys=(0,Me.createSelector)([Js,D,_],(s,e,t)=>s?{requestedBy:s.requestedBy?e[s.requestedBy]:void 0,role:t[s.roleName],token:s.token}:null),Xs=(0,Me.createSelector)([oe],s=>{var o;let e=!1,t=!1,i=!1;return((o=s==null?void 0:s.publishParams)==null?void 0:o.allowed)&&(e=s.publishParams.allowed.includes("video"),t=s.publishParams.allowed.includes("audio"),i=s.publishParams.allowed.includes("screen")),{video:e,audio:t,screen:i}});var V=I(require("reselect"));var zs=s=>(0,V.createSelector)([_],e=>e[s]),Zs=(0,V.createSelector)([L,y],(s,e)=>{let t=null;return s&&(t=e[s]),(t==null?void 0:t.plugins)||[]}),ei=(0,V.createSelector)([A,y],(s,e)=>{let t=null;return s&&(t=e[s]),(t==null?void 0:t.plugins)||[]}),ti=s=>(0,V.createSelector)([Zs],e=>e.includes(s)),si=s=>(0,V.createSelector)([ei],e=>e.includes(s)),ii=s=>(0,V.createSelector)(F,e=>e.find(s)),oi=s=>(0,V.createSelector)(F,e=>e.filter(s)),ri=s=>(0,V.createSelector)(v,e=>e.joinedAt&&Date.now()-e.joinedAt.getTime()<=s);var ne=I(require("@100mslive/hms-video"));var me=I(require("@100mslive/hms-video"));function kt(s){return s instanceof me.HMSRemoteAudioTrack||s instanceof me.HMSRemoteVideoTrack}var ge=class{constructor(e,t,i,o){this.playlistManager=e;this.syncPlaylistState=i;this.store=o;this.type=t}play(e){return l(this,null,function*(){if(!e){m.w("Please pass id to play");return}yield this.playlistManager.setEnabled(!0,{id:e,type:this.type})})}pause(){return l(this,null,function*(){let e=this.type===M.audio?Ue:Ke,t=this.store.getState(e.selection);if(!t.id){m.w("No item is currently playing to pause");return}yield this.playlistManager.setEnabled(!1,{id:t.id,type:this.type})})}playNext(){return l(this,null,function*(){yield this.playlistManager.playNext(this.type)})}playPrevious(){return l(this,null,function*(){yield this.playlistManager.playPrevious(this.type)})}seek(e){this.playlistManager.seek(e,this.type),this.syncPlaylistState(`seekOn${this.type}Playlist`)}seekTo(e){this.playlistManager.seekTo(e,this.type),this.syncPlaylistState(`seekToOn${this.type}Playlist`)}setVolume(e){this.playlistManager.setVolume(e,this.type),this.syncPlaylistState(`setVolumeOn${this.type}Playlist`)}setList(e){this.playlistManager.setList(e),this.syncPlaylistState(`setListOn${this.type}Playlist`)}stop(){return l(this,null,function*(){yield this.playlistManager.stop(this.type),this.syncPlaylistState(`stop${this.type}Playlist`)})}setIsAutoplayOn(e){this.playlistManager.setIsAutoplayOn(this.type,e)}setPlaybackRate(e){this.playlistManager.setPlaybackRate(this.type,e),this.syncPlaylistState(`set${this.type}PlaybackRate`)}removeItem(e){return l(this,null,function*(){let t=yield this.playlistManager.removeItem(e,this.type);return t&&this.syncPlaylistState(`remove${this.type}PlaylistItem`),t})}clearList(){return l(this,null,function*(){yield this.playlistManager.clearList(this.type),this.syncPlaylistState(`clear${this.type}Playlist`)})}};var he={[c.HMSPeerUpdate.PEER_JOINED]:g.PEER_JOINED,[c.HMSPeerUpdate.PEER_LEFT]:g.PEER_LEFT,[c.HMSPeerUpdate.ROLE_UPDATED]:g.ROLE_UPDATED,[c.HMSPeerUpdate.NAME_UPDATED]:g.NAME_UPDATED,[c.HMSPeerUpdate.METADATA_UPDATED]:g.METADATA_UPDATED},Te={[c.HMSTrackUpdate.TRACK_ADDED]:g.TRACK_ADDED,[c.HMSTrackUpdate.TRACK_REMOVED]:g.TRACK_REMOVED,[c.HMSTrackUpdate.TRACK_MUTED]:g.TRACK_MUTED,[c.HMSTrackUpdate.TRACK_UNMUTED]:g.TRACK_UNMUTED,[c.HMSTrackUpdate.TRACK_DEGRADED]:g.TRACK_DEGRADED,[c.HMSTrackUpdate.TRACK_RESTORED]:g.TRACK_RESTORED,[c.HMSTrackUpdate.TRACK_DESCRIPTION_CHANGED]:g.TRACK_DESCRIPTION_CHANGED};var Fe=class{constructor(e,t,i){this.hmsSDKTracks={};this.hmsSDKPeers={};this.isRoomJoinCalled=!1;this.ignoredMessageTypes=[];this.setProgress=({type:e,progress:t})=>{this.setState(i=>{i.playlist[e].progress=t,i.playlist[e].currentTime=this.sdk.getPlaylistManager().getCurrentTime(e)},"playlistProgress")};this.syncPlaylistState=e=>{this.setState(t=>{Object.assign(t.playlist,h.convertPlaylist(this.sdk.getPlaylistManager()))},e)};this.sendPeerUpdateNotification=(e,t)=>{let i=this.store.getState(x(t.peerId)),o=he[e]||"peerUpdate";this.syncRoomState(o),i||(i=this.store.getState(x(t.peerId))),this.hmsNotifications.sendPeerUpdate(e,i)};this.setState=(e,t)=>this.store.namedSetState(e,t);this.store=e,this.sdk=t,this.hmsNotifications=i}refreshDevices(){return l(this,null,function*(){yield this.sdk.refreshDevices()})}unblockAudio(){return l(this,null,function*(){yield this.sdk.getAudioOutput().unblockAutoplay()})}setVolume(e,t){t?this.setTrackVolume(e,t):(this.sdk.getAudioOutput().setVolume(e),this.syncRoomState("setOutputVolume"))}setAudioOutputDevice(e){this.sdk.getAudioOutput().setDevice(e)&&this.setState(i=>{i.settings.audioOutputDeviceId=e},"setAudioOutputDevice")}setPreferredLayer(e,t){let i=this.hmsSDKTracks[e];i?i instanceof ne.HMSRemoteVideoTrack?(i.preferLayer(t),this.updateVideoLayer(e,"setPreferredLayer")):m.w(`track ${e} is not an video track`):this.logPossibleInconsistency(`track ${e} not present, unable to set preffer layer`)}preview(e){return l(this,null,function*(){if(this.isRoomJoinCalled){this.logPossibleInconsistency("attempting to call preview after join was called");return}let t=this.store.getState(E);if(t===T.Preview||t===T.Connecting){this.logPossibleInconsistency("attempting to call preview while room is in preview/connecting");return}try{this.setState(i=>{i.room.roomState=T.Connecting},"connecting"),yield this.sdkPreviewWithListeners(e)}catch(i){throw m.e("Cannot show preview. Failed to connect to room - ",i),i}})}join(e){if(this.isRoomJoinCalled){this.logPossibleInconsistency("room join is called again");return}try{this.isRoomJoinCalled=!0,this.setState(t=>{t.room.roomState=T.Connecting},"join"),this.sdkJoinWithListeners(e)}catch(t){throw this.isRoomJoinCalled=!1,m.e("Failed to connect to room - ",t),t}}leave(){return l(this,null,function*(){if(!this.store.getState(xe)){this.logPossibleInconsistency("room leave is called when no room is connected");return}let t=this.store.getState(E);return this.setState(i=>{i.room.roomState=T.Disconnecting},"leaving"),this.sdk.leave().then(()=>{this.resetState("leave"),m.i("left room")}).catch(i=>{m.e("error in leaving room - ",i),this.setState(o=>{o.room.roomState=t},"revertLeave")})})}setScreenShareEnabled(e,t){return l(this,null,function*(){let i={audioOnly:!1,videoOnly:!1};typeof t=="object"?Object.assign(i,t):typeof t=="boolean"&&(i.audioOnly=t);try{e?yield this.startScreenShare(i):yield this.stopScreenShare()}catch(o){throw this.hmsNotifications.sendError(h.convertException(o)),o}})}addTrack(e,t="regular"){return l(this,null,function*(){yield this.sdk.addTrack(e,t),this.syncRoomState("addTrack")})}removeTrack(e){return l(this,null,function*(){yield this.sdk.removeTrack(e),this.syncRoomState("removeTrack")})}setLocalAudioEnabled(e){return l(this,null,function*(){let t=this.store.getState(A);t&&(yield this.setEnabledTrack(t,e))})}setLocalVideoEnabled(e){return l(this,null,function*(){let t=this.store.getState(L);t&&(yield this.setEnabledTrack(t,e))})}setEnabledTrack(e,t){return l(this,null,function*(){var r;if(((r=this.store.getState().tracks[e])==null?void 0:r.enabled)===t){this.logPossibleInconsistency(`local track[${e}] enabled state - ${t}`);return}this.setState(n=>{n.tracks[e]?n.tracks[e].displayEnabled=t:this.logPossibleInconsistency("track id not found for setEnabled")},"displayEnabled");try{yield this.setEnabledSDKTrack(e,t),this.syncRoomState("setEnabled")}catch(n){throw this.setState(a=>{a.tracks[e].displayEnabled=!t},"rollbackDisplayEnabled"),this.hmsNotifications.sendError(h.convertException(n)),n}let o=t?c.HMSTrackUpdate.TRACK_UNMUTED:c.HMSTrackUpdate.TRACK_MUTED;this.hmsNotifications.sendTrackUpdate(o,e)})}setAudioSettings(e){return l(this,null,function*(){let t=this.store.getState(A);t&&(yield this.setSDKLocalAudioTrackSettings(t,e),this.syncRoomState("setAudioSettings"))})}setVideoSettings(e){return l(this,null,function*(){let t=this.store.getState(L);t&&(yield this.setSDKLocalVideoTrackSettings(t,e),this.syncRoomState("setVideoSettings"))})}sendMessage(e){this.sendBroadcastMessage(e)}sendBroadcastMessage(e,t){return l(this,null,function*(){let i=yield this.sdk.sendBroadcastMessage(e,t);this.updateMessageInStore(i,{message:e,type:t})})}sendGroupMessage(e,t,i){return l(this,null,function*(){let o=this.store.getState(_),r=t.map(a=>o[a]),n=yield this.sdk.sendGroupMessage(e,r,i);this.updateMessageInStore(n,{message:e,recipientRoles:t,type:i})})}sendDirectMessage(e,t,i){return l(this,null,function*(){let o=this.hmsSDKPeers[t],r=yield this.sdk.sendDirectMessage(e,o,i);this.updateMessageInStore(r,{message:e,recipientPeer:o.peerId,type:i})})}updateMessageInStore(e,t){if(!e)throw m.w("sendMessage","Failed to send message",t),Error(`sendMessage Failed - ${JSON.stringify(t)}`);let i=h.convertMessage(e);return i.read=!0,i.senderName="You",i.ignored=this.ignoredMessageTypes.includes(i.type),this.putMessageInStore(i),i}setMessageRead(e,t){this.setState(i=>{t?i.messages.byID[t]?i.messages.byID[t].read=e:this.logPossibleInconsistency("no message with id is found"):i.messages.allIDs.forEach(o=>{i.messages.byID[o].read=e})},"setMessageRead")}attachVideo(e,t){return l(this,null,function*(){if(this.localAndVideoUnmuting(e))return new Promise(i=>{let o=this.store.subscribe(r=>l(this,null,function*(){r&&(yield this.attachVideoInternal(e,t),o(),i())}),ue)});yield this.attachVideoInternal(e,t)})}detachVideo(e,t){return l(this,null,function*(){let i=this.hmsSDKTracks[e];(i==null?void 0:i.type)==="video"?(i.removeSink(t),this.updateVideoLayer(e,"detachVideo")):(t&&(t.srcObject=null),this.logPossibleInconsistency("no video track found to remove sink"))})}addPluginToVideoTrack(e,t){return l(this,null,function*(){return this.addRemoveVideoPlugin(e,"add",t)})}addPluginToAudioTrack(e){return l(this,null,function*(){return this.addRemoveAudioPlugin(e,"add")})}validateVideoPluginSupport(e){let t={};if(t.isSupported=!1,!e)return m.w("no plugin passed in for checking support"),t.errMsg="no plugin passed in for checking support",t;let i=this.store.getState(L);if(i){let o=this.hmsSDKTracks[i];o?t=o.validatePlugin(e):(m.w(`track ${i} not present, unable to validate plugin`),t.errMsg=`track ${i} not present, unable to validate plugin`)}return t}validateAudioPluginSupport(e){let t={};if(t.isSupported=!1,!e)return m.w('no plugin passed in for checking support"'),t.errMsg='no plugin passed in for checking support"',t;let i=this.store.getState(A);if(i){let o=this.hmsSDKTracks[i];o?t=o.validatePlugin(e):(m.w(`track ${i} not present, unable to validate plugin`),t.errMsg=`track ${i} not present, unable to validate plugin`)}return t}removePluginFromVideoTrack(e){return l(this,null,function*(){return this.addRemoveVideoPlugin(e,"remove")})}removePluginFromAudioTrack(e){return l(this,null,function*(){return this.addRemoveAudioPlugin(e,"remove")})}changeRole(e,t,i=!1){return l(this,null,function*(){let o=this.hmsSDKPeers[e];if(!o){this.logPossibleInconsistency(`Unknown peer ID given ${e} for changerole`);return}yield this.sdk.changeRole(o,t,i)})}acceptChangeRole(e){return l(this,null,function*(){let t=e.requestedBy?this.hmsSDKPeers[e.requestedBy.id]:void 0;t||m.w(`peer for which role change is requested no longer available - ${e.requestedBy}`);let i={requestedBy:t,role:e.role,token:e.token};yield this.sdk.acceptChangeRole(i),this.removeRoleChangeRequest(e)})}initAppData(e){this.setState(t=>{t.appData=e},"initAppData")}setAppData(e,t,i){let o=(t==null?void 0:t.constructor.name)==="Object";this.setState(r=>{if(r.appData)i&&o?Object.assign(r.appData[e],t):r.appData[e]=t;else{let n={[e]:t};r.appData=n}},`setAppData-${e}`)}rejectChangeRole(e){this.removeRoleChangeRequest(e)}endRoom(e,t){return l(this,null,function*(){let i=this.store.getState(Oe);if(!(i==null?void 0:i.endRoom)){m.w("You are not allowed to perform this action - endRoom");return}let o=this.store.getState(E);this.setState(r=>{r.room.roomState=T.Disconnecting},"endingRoom");try{yield this.sdk.endRoom(e,t),this.resetState("endRoom")}catch(r){m.e("error in ending room - ",r),this.setState(n=>{n.room.roomState=o},"revertEndRoom")}})}removePeer(e,t){return l(this,null,function*(){let i=this.hmsSDKPeers[e];if(i&&!i.isLocal)yield this.sdk.removePeer(i,t);else{this.logPossibleInconsistency(`No remote peer found for peerID - ${e}`);return}})}startRTMPOrRecording(e){return l(this,null,function*(){yield this.sdk.startRTMPOrRecording(e)})}stopRTMPAndRecording(){return l(this,null,function*(){yield this.sdk.stopRTMPAndRecording()})}startHLSStreaming(e){return l(this,null,function*(){yield this.sdk.startHLSStreaming(e)})}stopHLSStreaming(e){return l(this,null,function*(){yield this.sdk.stopHLSStreaming(e)})}sendHLSTimedMetadata(e){return l(this,null,function*(){yield this.sdk.sendHLSTimedMetadata(e)})}changeName(e){return l(this,null,function*(){yield this.sdk.changeName(e)})}changeMetadata(e){return l(this,null,function*(){typeof e!="string"&&(e=JSON.stringify(e)),yield this.sdk.changeMetadata(e)})}setRemoteTrackEnabled(e,t){return l(this,null,function*(){if(typeof e=="string"){let i=this.hmsSDKTracks[e];i&&kt(i)?yield this.sdk.changeTrackState(i,t):this.logPossibleInconsistency(`No remote track with ID ${e} found for change track state`)}else Array.isArray(e)&&e.forEach(i=>this.setRemoteTrackEnabled(i,t))})}setRemoteTracksEnabled(e){return l(this,null,function*(){let t={enabled:e.enabled,type:e.type,source:e.source};if(e.roles){let i=this.store.getState(_);t.roles=e.roles.map(o=>i[o])}yield this.sdk.changeMultiTrackState(t)})}setLogLevel(e){m.level=e,this.sdk.setLogLevel(e)}ignoreMessageTypes(e,t=!1){if(t)this.ignoredMessageTypes=e;else for(let i of e)this.ignoredMessageTypes.includes(i)||this.ignoredMessageTypes.push(i)}resetState(e="resetState"){this.isRoomJoinCalled=!1,this.hmsSDKTracks={},m.cleanUp(),this.setState(t=>{Object.assign(t,z())},e)}sdkJoinWithListeners(e){this.sdk.join(e,{onJoin:this.onJoin.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this),onMessageReceived:this.onMessageReceived.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onRoleChangeRequest:this.onRoleChangeRequest.bind(this),onRoleUpdate:this.onRoleUpdate.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onChangeTrackStateRequest:this.onChangeTrackStateRequest.bind(this),onChangeMultiTrackStateRequest:this.onChangeMultiTrackStateRequest.bind(this),onRemovedFromRoom:this.onRemovedFromRoom.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)}),this.sdk.addConnectionQualityListener({onConnectionQualityUpdate:this.onConnectionQualityUpdate.bind(this)})}onRemovedFromRoom(e){var o;let t=this.store.getState(x((o=e.requestedBy)==null?void 0:o.peerId));this.hmsNotifications.sendLeaveRoom(W(w({},e),{requestedBy:t||void 0}));let i=e.roomEnded||!t?"roomEnded":"removedFromRoom";m.i(`resetting state after peer removed ${i}`,e),this.resetState(i)}onDeviceChange(e){let t=e.devices;if(!t)return;let i=this.store.getState(b);if(this.setState(o=>{U(o.devices.audioInput,t.audioInput)||(o.devices.audioInput=t.audioInput),U(o.devices.videoInput,t.videoInput)||(o.devices.videoInput=t.videoInput),U(o.devices.audioOutput,t.audioOutput)||(o.devices.audioOutput=t.audioOutput),this.hmsSDKPeers[i==null?void 0:i.id]&&Object.assign(o.settings,this.getMediaSettings(this.hmsSDKPeers[i==null?void 0:i.id]))},"deviceChange"),e.selection){let o=h.convertDeviceChangeUpdate(e);this.hmsNotifications.sendDeviceChange(o)}}sdkPreviewWithListeners(e){return l(this,null,function*(){yield this.sdk.preview(e,{onPreview:this.onPreview.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)})})}onNetworkQuality(e){this.setState(t=>{var o;let i=t.room.localPeer||((o=this.sdk.getLocalPeer())==null?void 0:o.peerId);i&&(t.connectionQualities[i]={peerID:i,downlinkQuality:e})},"ConnectionQuality")}startScreenShare(e){return l(this,null,function*(){this.store.getState(pe)?this.logPossibleInconsistency("start screenshare is called while it's on"):(yield this.sdk.startScreenShare(()=>this.syncRoomState("screenshareStopped"),e),this.syncRoomState("startScreenShare"))})}stopScreenShare(){return l(this,null,function*(){this.store.getState(pe)?(yield this.sdk.stopScreenShare(),this.syncRoomState("stopScreenShare")):this.logPossibleInconsistency("stop screenshare is called while it's not on")})}attachVideoInternal(e,t){return l(this,null,function*(){let i=this.hmsSDKTracks[e];i&&i.type==="video"?(i.addSink(t),this.updateVideoLayer(e,"attachVideo")):this.logPossibleInconsistency("no video track found to add sink")})}syncRoomState(e){e=`${e}_fullSync`,m.time(`store-sync-${e}`);let t={},i=[],o={},r={},n={},a=this.sdk.getPeers();for(let k of a){let N=h.convertPeer(k);t[N.id]=N,i.push(N.id),this.hmsSDKPeers[N.id]=k;let Y=[k.audioTrack,k.videoTrack,...k.auxiliaryTracks];for(let le of Y){if(!le)continue;let Ye=h.convertTrack(le);o[Ye.id]=Ye,r[le.trackId]=le}N.isLocal&&Object.assign(n,this.getMediaSettings(k))}let u=this.sdk.getRecordingState(),P=this.sdk.getRTMPState(),j=this.sdk.getHLSState();this.setState(k=>{k.room.peers=i;let N=k.peers,Y=k.tracks;tt(N,t),st(Y,o),Object.assign(k.settings,n),this.hmsSDKTracks=r,Object.assign(k.roles,h.convertRoles(this.sdk.getRoles())),Object.assign(k.playlist,h.convertPlaylist(this.sdk.getPlaylistManager())),Object.assign(k.room,h.convertRecordingStreamingState(u,P,j))},e),m.timeEnd(`store-sync-${e}`)}onPreview(e){this.setState(t=>{Object.assign(t.room,h.convertRoom(e)),t.room.roomState=T.Preview},"previewStart"),this.syncRoomState("previewSync")}onJoin(e){let t=this.sdk.getPlaylistManager();this.audioPlaylist=new ge(t,M.audio,this.syncPlaylistState.bind(this),this.store),this.videoPlaylist=new ge(t,M.video,this.syncRoomState.bind(this),this.store),this.syncRoomState("joinSync"),this.setState(i=>{Object.assign(i.room,h.convertRoom(e)),i.room.isConnected=!0,i.room.roomState=T.Connected},"joined"),t.onProgress(this.setProgress),t.onNewTrackStart(i=>{this.syncPlaylistState(`${i.type}PlaylistUpdate`)}),t.onPlaylistEnded(i=>{this.syncPlaylistState(`${i}PlaylistEnded`)}),t.onCurrentTrackEnded(i=>{this.hmsNotifications.sendPlaylistTrackEnded(h.convertPlaylistItem(t,i)),this.syncPlaylistState(`${i.type}PlaylistItemEnded`)})}onRoomUpdate(e,t){this.setState(i=>{Object.assign(i.room,h.convertRoom(t))},e)}onPeerUpdate(e,t){if(![c.HMSPeerUpdate.BECAME_DOMINANT_SPEAKER,c.HMSPeerUpdate.RESIGNED_DOMINANT_SPEAKER].includes(e)){if(Array.isArray(t)){this.syncRoomState("peersJoined");let i=[];for(let o of t){let r=this.store.getState(x(o.peerId));r&&i.push(r)}this.hmsNotifications.sendPeerList(i);return}this.sendPeerUpdateNotification(e,t)}}onTrackUpdate(e,t,i){if(e===c.HMSTrackUpdate.TRACK_REMOVED)this.hmsNotifications.sendTrackUpdate(e,t.trackId),this.handleTrackRemove(t,i);else{let o=Te[e]||"trackUpdate";this.syncRoomState(o),this.hmsNotifications.sendTrackUpdate(e,t.trackId)}}onMessageReceived(e){let t=h.convertMessage(e);t.read=!1,t.ignored=this.ignoredMessageTypes.includes(t.type),this.putMessageInStore(t),this.hmsNotifications.sendMessageReceived(t)}putMessageInStore(e){e.ignored||this.setState(t=>{e.id=String(this.store.getState(Le)+1),t.messages.byID[e.id]=e,t.messages.allIDs.push(e.id)},"newMessage")}onAudioLevelUpdate(e){this.setState(t=>{let i={};e.forEach(r=>{if(!r.track||!r.peer)return;let n=r.track.trackId;i[n]=r.audioLevel,t.speakers[n]||(t.speakers[n]={audioLevel:r.audioLevel,peerID:r.peer.peerId,trackID:n})});let o=Object.entries(t.speakers);for(let[r,n]of o)n.audioLevel=i[r]||0,n.audioLevel===0&&delete t.speakers[r]},"audioLevel")}onConnectionQualityUpdate(e){this.setState(t=>{let i=new Set;e.forEach(r=>{let n=r.peerID;!n||(i.add(n),t.connectionQualities[n]?Object.assign(t.connectionQualities[n],r):t.connectionQualities[n]=r)});let o=Object.keys(t.connectionQualities);for(let r of o)i.has(r)||delete t.connectionQualities[r]},"connectionQuality")}onChangeTrackStateRequest(e){var r;let t=this.store.getState(x((r=e.requestedBy)==null?void 0:r.peerId)),i=this.getStoreLocalTrackIDfromSDKTrack(e.track),o=this.store.getState(G(i));if(!o)return this.logPossibleInconsistency(`Not found track for which track state change was requested, ${e.track}`);e.enabled||this.syncRoomState("changeTrackStateRequest"),this.hmsNotifications.sendChangeTrackStateRequest({requestedBy:t||void 0,track:o,enabled:e.enabled})}onChangeMultiTrackStateRequest(e){var r;let t=this.store.getState(x((r=e.requestedBy)==null?void 0:r.peerId));e.enabled||this.syncRoomState("changeMultiTrackStateRequest");let i=[],o=this.store.getState(y);for(let n of e.tracks){let a=this.getStoreLocalTrackIDfromSDKTrack(n);a&&o[a]&&i.push(o[a])}this.hmsNotifications.sendChangeMultiTrackStateRequest({requestedBy:t||void 0,tracks:i,enabled:e.enabled,type:e.type,source:e.source})}onReconnected(){this.syncRoomState("reconnectedSync"),this.hmsNotifications.sendReconnected(),this.setState(e=>{e.room.roomState=e.room.isConnected?T.Connected:T.Preview},"reconnected")}onReconnecting(e){let t=h.convertException(e);m.e("Reconnection: received error from sdk",t),this.hmsNotifications.sendReconnecting(t),this.setState(i=>{i.room.roomState=T.Reconnecting,i.errors.push(t)},"reconnecting")}onError(e){let t=h.convertException(e);t.isTerminal?(this.leave().then(()=>m.e("error from SDK, left room.")),this.setState(i=>{i.room.roomState=T.Failed,i.errors.push(t)},"errorTerminal")):this.store.getState().errors.length<50&&this.setState(o=>{o.errors.push(t)},"error"),this.syncRoomState("errorSync"),this.hmsNotifications.sendError(t),m.e("received error from sdk",t)}updateVideoLayer(e,t){let i=this.hmsSDKTracks[e];if(i&&i instanceof ne.HMSRemoteVideoTrack){let o=this.store.getState(G(e));((o==null?void 0:o.layer)!==i.getSimulcastLayer()||(o==null?void 0:o.degraded)!==i.degraded)&&this.setState(n=>{n.tracks[e].layer=i.getSimulcastLayer(),n.tracks[e].degraded=i.degraded},t)}}handleTrackRemove(e,t){this.setState(i=>{let o=i.peers[t.peerId],r=i.tracks,n=e.trackId;if(this.isSameStoreSDKTrack(n,o==null?void 0:o.audioTrack))o==null||delete o.audioTrack;else if(this.isSameStoreSDKTrack(n,o==null?void 0:o.videoTrack))o==null||delete o.videoTrack;else{let a=o==null?void 0:o.auxiliaryTracks.indexOf(n);a>-1&&this.isSameStoreSDKTrack(n,o==null?void 0:o.auxiliaryTracks[a])&&(o==null||o.auxiliaryTracks.splice(a,1))}delete r[n],delete this.hmsSDKTracks[n]},"trackRemoved")}setEnabledSDKTrack(e,t){return l(this,null,function*(){let i=this.hmsSDKTracks[e];i?yield i.setEnabled(t):this.logPossibleInconsistency(`track ${e} not present, unable to enabled/disable`)})}setSDKLocalVideoTrackSettings(e,t){return l(this,null,function*(){let i=this.hmsSDKTracks[e];i?yield i.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)})}setSDKLocalAudioTrackSettings(e,t){return l(this,null,function*(){let i=this.hmsSDKTracks[e];i?yield i.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)})}getMediaSettings(e){var r;let t=this.store.getState(Ee),i=e.audioTrack,o=e.videoTrack;return{audioInputDeviceId:(i==null?void 0:i.settings.deviceId)||t.audioInputDeviceId,videoInputDeviceId:(o==null?void 0:o.settings.deviceId)||t.videoInputDeviceId,audioOutputDeviceId:(r=this.sdk.getAudioOutput().getDevice())==null?void 0:r.deviceId}}setTrackVolume(e,t){let i=this.hmsSDKTracks[t];i?i instanceof ne.HMSAudioTrack?(i.setVolume(e),this.setState(o=>{let r=o.tracks[t];r&&(r.volume=e)},"trackVolume")):m.w(`track ${t} is not an audio track`):this.logPossibleInconsistency(`track ${t} not present, unable to set volume`)}localAndVideoUnmuting(e){if(this.store.getState(b).videoTrack!==e)return!1;let i=this.store.getState(Ae),o=this.store.getState(ue);return i&&!o}logPossibleInconsistency(e){m.w("possible inconsistency detected - ",e)}addRemoveVideoPlugin(e,t,i){return l(this,null,function*(){if(!e){m.w("Invalid plugin received in store");return}let o=this.store.getState(L);if(o){let r=this.hmsSDKTracks[o];r?(t==="add"?yield r.addPlugin(e,i):t==="remove"&&(yield r.removePlugin(e)),this.syncRoomState(`${t}VideoPlugin`)):this.logPossibleInconsistency(`track ${o} not present, unable to remove plugin`)}})}addRemoveAudioPlugin(e,t){return l(this,null,function*(){if(!e){m.w("Invalid plugin received in store");return}let i=this.store.getState(A);if(i){let o=this.hmsSDKTracks[i];o?(t==="add"?yield o.addPlugin(e):t==="remove"&&(yield o.removePlugin(e)),this.syncRoomState(`${t}AudioPlugin`)):this.logPossibleInconsistency(`track ${i} not present, unable to remove plugin`)}})}isSameStoreSDKTrack(e,t){var i;return t?((i=this.hmsSDKTracks[t])==null?void 0:i.trackId)===e:!1}onRoleChangeRequest(e){this.setState(t=>{t.roleChangeRequests.length===0&&t.roleChangeRequests.push(h.convertRoleChangeRequest(e))},"roleChangeRequest")}removeRoleChangeRequest(e){this.setState(t=>{let i=t.roleChangeRequests.findIndex(o=>o.token===e.token);i!==-1&&t.roleChangeRequests.splice(i,1)},"removeRoleChangeRequest")}onRoleUpdate(){this.syncRoomState("roleUpdate")}getStoreLocalTrackIDfromSDKTrack(e){return this.store.getState(Ce).find(i=>this.hmsSDKTracks[i].trackId===e.trackId)}};var Pt=I(require("eventemitter2"));var We="hmsNotification",Qe=class{constructor(e){this.id=0;this.onNotification=(e,t)=>{let i=o=>{if(t){let r;if(Array.isArray(t)?r=t.includes(o.type):r=t===o.type,!r)return}e(o)};return this.eventEmitter.addListener(We,i),()=>{this.eventEmitter.removeListener(We,i)}};this.store=e,this.eventEmitter=new Pt.EventEmitter2}sendPlaylistTrackEnded(e){let t=this.createNotification(g.PLAYLIST_TRACK_ENDED,e,R.INFO);this.emitEvent(t)}sendDeviceChange(e){var i;let t=this.createNotification(g.DEVICE_CHANGE_UPDATE,e,e.error?R.ERROR:R.INFO,`Selected ${e.type} device - ${(i=e.selection)==null?void 0:i.label}`);this.emitEvent(t)}sendLeaveRoom(e){var o;let t=(o=e.requestedBy)==null?void 0:o.name,i=this.createNotification(e.roomEnded||!t?g.ROOM_ENDED:g.REMOVED_FROM_ROOM,e,R.INFO,`${e.roomEnded?"Room ended":"Removed from room"} ${t?`by ${t}`:""}`);this.emitEvent(i)}sendPeerList(e){let t=this.createNotification(g.PEER_LIST,e,R.INFO);this.emitEvent(t)}sendPeerUpdate(e,t){let i=this.store.getState(x(t==null?void 0:t.id))||t,o=he[e];if(o){let r=this.createNotification(o,i,R.INFO);this.emitEvent(r)}}sendTrackUpdate(e,t){let i=this.store.getState(G(t)),o=Te[e];if(o){let r=this.createNotification(o,i,R.INFO);this.emitEvent(r)}}sendMessageReceived(e){let t=this.createNotification(g.NEW_MESSAGE,e,R.INFO);this.emitEvent(t)}sendError(e){let t=this.createNotification(g.ERROR,e,R.ERROR);this.emitEvent(t)}sendReconnecting(e){let t=this.createNotification(g.RECONNECTING,e,R.ERROR);this.emitEvent(t)}sendReconnected(){let e=this.createNotification(g.RECONNECTED,null,R.INFO);this.emitEvent(e)}sendChangeTrackStateRequest(e){let t=this.createNotification(g.CHANGE_TRACK_STATE_REQUEST,e,R.INFO);this.emitEvent(t)}sendChangeMultiTrackStateRequest(e){let t=this.createNotification(g.CHANGE_MULTI_TRACK_STATE_REQUEST,e,R.INFO);this.emitEvent(t)}emitEvent(e){this.eventEmitter.emit(We,e)}createNotification(e,t,i,o=""){return this.id++,{id:this.id,type:e,message:o,data:t,severity:i}}};var Rt=I(require("@100mslive/hms-video")),He=s=>Rt.isBrowser?`${s} ${document.title}`:s;var It=(s,e,t)=>{let i;t.getState(E)===T.Connected&&(i=vt(s,e,t)),t.subscribe(o=>{[T.Connected,T.Reconnecting].includes(o)?i||(i=vt(s,e,t)):i&&(ci(e),i())},E)},vt=(s,e,t)=>{var r,n;let i=ni(t,e);(r=s.getWebrtcInternals())==null||r.start();let o=(n=s.getWebrtcInternals())==null?void 0:n.onStatsChange(a=>ai(e,a,t));return()=>{i(),o&&o()}},ni=(s,e)=>{let t,i,o;return s.getState(q)?e.namedSetState(r=>{r.localPeer.id=s.getState(q)},"localpeer-id"):t=s.subscribe(r=>{r&&e.namedSetState(n=>{n.localPeer.id=r},"localpeer-id")},q),s.getState(L)?e.namedSetState(r=>{r.localPeer.videoTrack=s.getState(L)},"localpeer-videotrack-id"):i=s.subscribe(r=>{r&&e.namedSetState(n=>{n.localPeer.videoTrack=r},"localpeer-videotrack-id")},L),s.getState(A)?e.namedSetState(r=>{r.localPeer.videoTrack=s.getState(A)},"localpeer-audiotrack-id"):o=s.subscribe(r=>{r&&e.namedSetState(n=>{n.localPeer.videoTrack=r},"localpeer-audiotrack-id")},A),()=>{t==null||t(),i==null||i(),o==null||o()}},ai=(s,e,t)=>{let i=t.getState(y);s.namedSetState(o=>{let r={},n=Object.keys(i);for(let P of n){let j=e.getTrackStats(P);j&&(r[P]=j)}ke(o.trackStats,r);let u={[t.getState(q)]:e.getLocalPeerStats()};ke(o.peerStats,u)},"webrtc-stats")},ci=(s,e="resetState")=>{s.namedSetState(t=>{Object.assign(t,Z())},e)};var ae=class{constructor(e,t){this.hmsStore=e;this.sdk=t;this.store=O.createNewHMSStore(He("HMSStatsStore"),Z),this.getState=this.store.getState,this.subscribe=this.store.subscribe,this.getPublishPeerConnection=()=>new Promise(i=>{var o,r;this.hmsStore.getState(E)==="Connected"?i((r=(o=this.sdk)==null?void 0:o.getWebrtcInternals())==null?void 0:r.getPublishPeerConnection()):this.hmsStore.subscribe(n=>{var a,u;n==="Connected"&&i((u=(a=this.sdk)==null?void 0:a.getWebrtcInternals())==null?void 0:u.getPublishPeerConnection())},E)}),this.getSubscribePeerConnection=()=>new Promise(i=>{var o,r;this.hmsStore.getState(E)==="Connected"?i((r=(o=this.sdk)==null?void 0:o.getWebrtcInternals())==null?void 0:r.getSubscribePeerConnection()):this.hmsStore.subscribe(n=>{var a,u;n==="Connected"&&i((u=(a=this.sdk)==null?void 0:a.getWebrtcInternals())==null?void 0:u.getSubscribePeerConnection())},E)}),!!this.sdk&&It(this.sdk,this.store,this.hmsStore)}};var H=I(require("reselect"));var li=s=>s.localPeer.id,Si=s=>s.localPeer.audioTrack,di=s=>s.localPeer.videoTrack,ui=(s,e)=>e,pi=(s,e)=>e,Ge=s=>s.trackStats,Dt=s=>s.peerStats,B=(0,H.createSelector)([Dt,li],(s,e)=>s[e]),Mi=(0,H.createSelector)(B,s=>{var e;return(e=s==null?void 0:s.subscribe)==null?void 0:e.packetsLost}),mi=(0,H.createSelector)(B,s=>{var e;return(e=s==null?void 0:s.subscribe)==null?void 0:e.jitter}),gi=(0,H.createSelector)(B,s=>{var e;return(e=s==null?void 0:s.publish)==null?void 0:e.bitrate}),hi=(0,H.createSelector)(B,s=>{var e;return(e=s==null?void 0:s.subscribe)==null?void 0:e.bitrate}),Ti=(0,H.createSelector)(B,s=>{var e;return(e=s==null?void 0:s.publish)==null?void 0:e.availableOutgoingBitrate}),Hi=(0,H.createSelector)(B,s=>{var e;return(e=s==null?void 0:s.subscribe)==null?void 0:e.availableIncomingBitrate}),yi=(0,H.createSelector)(B,s=>{var e;return(e=s==null?void 0:s.publish)==null?void 0:e.bytesSent}),fi=(0,H.createSelector)(B,s=>{var e;return(e=s==null?void 0:s.subscribe)==null?void 0:e.bytesReceived}),ki=(0,H.createSelector)([Dt,ui],(s,e)=>e?s[e]:void 0),J=(0,H.createSelector)([Ge,pi],(s,e)=>e?s[e]:void 0),Pi=p(ki),Ri=p(J),Ii=p((0,H.createSelector)(J,s=>s==null?void 0:s.bitrate)),vi=p((0,H.createSelector)(J,s=>s==null?void 0:s.bytesReceived)),Di=p((0,H.createSelector)(J,s=>s==null?void 0:s.framesPerSecond)),bi=p((0,H.createSelector)(J,s=>s==null?void 0:s.jitter)),Ei=p((0,H.createSelector)(J,s=>s==null?void 0:s.packetsLost)),Je=(0,H.createSelector)([Ge,Si],(s,e)=>e?s[e]:void 0),ce=(0,H.createSelector)([Ge,di],(s,e)=>e?s[e]:void 0),Ci=(0,H.createSelector)(Je,s=>s==null?void 0:s.bitrate),Ai=(0,H.createSelector)(ce,s=>s==null?void 0:s.bitrate),Li=(0,H.createSelector)(Je,s=>s==null?void 0:s.bytesSent),xi=(0,H.createSelector)(ce,s=>s==null?void 0:s.bytesSent),Oi=(0,H.createSelector)(ce,s=>s==null?void 0:s.framesPerSecond),Ni=(0,H.createSelector)(ce,s=>s==null?void 0:s.qualityLimitationReason),bt={localPeerStats:B,packetsLost:Mi,jitter:mi,publishBitrate:gi,subscribeBitrate:hi,availablePublishBitrate:Ti,availableSubscribeBitrate:Hi,totalBytesSent:yi,totalBytesReceived:fi,peerStatsByID:Pi,trackStatsByID:Ri,bitrateByTrackID:Ii,bytesReceivedByTrackID:vi,framerateByTrackID:Di,jitterByTrackID:bi,packetsLostByTrackID:Ei,localAudioTrackStats:Je,localVideoTrackStats:ce,localAudioTrackBitrate:Ci,localVideoTrackBitrate:Ai,localAudioTrackBytesSent:Li,localVideoTrackBytesSent:xi,localVideoTrackFramerate:Oi,localVideoTrackQualityLimitationReason:Ni};var O=class{constructor(e,t,i){this.getStats=()=>(this.stats||(this.stats=new ae(this.store,this.sdk)),this.stats);e?this.store=e:this.store=O.createNewHMSStore(He("HMSStore"),z),i?this.notifications=i:this.notifications=new Qe(this.store),t?this.actions=t:(this.sdk=new ye.HMSSdk,this.actions=new Fe(this.store,this.sdk,this.notifications)),this.initialTriggerOnSubscribe=!1,ye.isBrowser&&(window.__hms=this)}triggerOnSubscribe(){this.initialTriggerOnSubscribe||(O.makeStoreTriggerOnSubscribe(this.store),this.initialTriggerOnSubscribe=!0)}getStore(){return this.store}getHMSActions(){return this.actions}getActions(){return this.actions}getNotifications(){return{onNotification:this.notifications.onNotification}}static createNewHMSStore(e,t){let i=(0,Ct.default)(()=>t()),o=i.setState;i.setState=a=>{let u=typeof a=="function"?(0,Et.default)(a):a;o(u)};let r=i.getState;i.getState=a=>{if(a){let u=a.name||"byIDSelector";window.selectorsCount||(window.selectorsCount={}),window.selectorsCount[u]=(window.selectorsCount[u]||0)+1;let P=performance.now(),j=a(r()),k=performance.now()-P;return k>1&&(window.expensiveSelectors=window.expensiveSelectors||new Map,window.expensiveSelectors.set(u,k)),j}return r()},O.compareWithShallowCheckInSubscribe(i);let n=O.setUpDevtools(i,e);return W(w({},i),{namedSetState:n})}static makeStoreTriggerOnSubscribe(e){let t=e.subscribe;e.subscribe=(i,o,r)=>(i(e.getState(o),void 0),t(i,o,r))}static compareWithShallowCheckInSubscribe(e){let t=e.subscribe;e.subscribe=(i,o,r)=>(o||(o=n=>n),r=r||At.default,t(i,o,r))}static setUpDevtools(e,t){let i;try{i=window.__REDUX_DEVTOOLS_EXTENSION__||window.top.__REDUX_DEVTOOLS_EXTENSION__}catch(n){}if(!i)return n=>{e.setState(n)};let o=i.connect(O.devtoolsOptions(t));o.prefix=t?`${t} > `:"";let r=e.setState;return e.setState=n=>{r(n),o.send(`${o.prefix}setState`,e.getState())},o.subscribe(O.devtoolsSubscribe(o,e,r)),o.send("setUpStore",e.getState()),(n,a)=>{r(n);let u=a||`${o.prefix}action`;o.send(u,e.getState())}}static devtoolsOptions(e){return{name:e,actionsBlacklist:["audioLevel","playlistProgress","connectionQuality"]}}static devtoolsSubscribe(e,t,i){return o=>{var r,n,a,u;if(o.type==="DISPATCH"&&o.state)["JUMP_TO_ACTION","JUMP_TO_STATE"].includes(o.payload.type)?i(JSON.parse(o.state)):t.setState(JSON.parse(o.state));else if(o.type==="DISPATCH"&&((r=o.payload)==null?void 0:r.type)==="COMMIT")e.init(t.getState());else if(o.type==="DISPATCH"&&((n=o.payload)==null?void 0:n.type)==="IMPORT_STATE"){let P=(a=o.payload.nextLiftedState)==null?void 0:a.actionsById;(((u=o.payload.nextLiftedState)==null?void 0:u.computedStates)||[]).forEach(({state:k},N)=>{let Y=P[N]||`${e.prefix}setState`;N===0?e.init(k):(i(k),e.send(Y,t.getState()))})}}}};
//# sourceMappingURL=index.cjs.js.map
